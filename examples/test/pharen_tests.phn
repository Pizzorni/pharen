(require "test.php")
(require "../../pharen.php")

(fn compiles-to (target source)
    (== (compile-file source "tmp") 
        (file-get-contents target)))

(fn run-test (fname msg)
    (it msg
        (check (. "tests/" fname ".phn") (compiles-to (. "tests/" fname ".php")))))

(let 
    [[tests (dict
        ("basic_func_call" "Compiles a basic function call")
        ("nested_func_call" "Compiles a function call nested in another")
        ("infix_call" "Compiles a call to the `+` infix operator of two integers and a float")
        ("def_definition" "Compiles a single definition of a variable using the 'def' form")
        ("vector_literals" "Compiles a vector literal of integers and another of strings")
    )]]
    
    (describe "Pharen compiler"
        (lambda ()
            (map-pairs "run-test" tests))))
